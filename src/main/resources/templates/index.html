<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Task Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center">
    <h1>Task Dashboard</h1>
    <small class="text-muted">Spring Boot + Thymeleaf + H2</small>
  </div>

  <ul class="nav nav-tabs mt-3" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">Dashboard</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks" type="button" role="tab">Tasks</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">Settings</button>
    </li>
  </ul>

  <div class="tab-content border p-3 bg-white" id="mainTabsContent">
    <!-- Dashboard -->
    <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
      <h4>Dashboard</h4>
      <p>Quick stats and recent tasks</p>
      <div class="row">
        <div class="col-md-4">
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Total Tasks</h5>
              <p class="card-text"><strong th:text="${tasks.size()}">0</strong></p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Completed</h5>
              <p class="card-text"><strong th:text="${#lists.size(tasks.?[done == true])}">0</strong></p>
            </div>
          </div>
        </div>
      </div>
      <h5>Recent</h5>
      <ul class="list-group">
        <li class="list-group-item" th:each="t : ${tasks}" th:text="${t.title}">Sample Task</li>
      </ul>
      	<!-- ðŸ”½ ADD THIS BLOCK ðŸ”½ -->
  <div class="card mt-4">
    <div class="card-body">
      <h5 class="card-title">Service B Integration</h5>
      <p class="card-text">
        Fetch data from Service B (background microservice call)
      </p>

      <form action="/service-b" method="get">
        <button class="btn btn-primary">
          Fetch from Service B
        </button>
      </form>

      <div class="mt-3" th:if="${serviceBResponse}">
        <span class="badge bg-success">Response:</span>
        <strong th:text="${serviceBResponse}"></strong>
      </div>
    </div>
  </div>
  <!-- ðŸ”¼ END ADD ðŸ”¼ -->
    </div>

    <!-- Tasks -->
    <div class="tab-pane fade" id="tasks" role="tabpanel">
      <h4>Tasks</h4>

      <form th:action="@{/tasks}" th:object="${newTask}" method="post" class="row g-2 mb-3">
        <div class="col-md-4">
          <input type="text" th:field="*{title}" class="form-control" placeholder="Task title" required/>
        </div>
        <div class="col-md-6">
          <input type="text" th:field="*{description}" class="form-control" placeholder="Short description"/>
        </div>
        <div class="col-md-2">
          <button class="btn btn-primary w-100">Add</button>
        </div>
      </form>

      <div class="list-group">
        <div class="list-group-item" th:each="t : ${tasks}">
          <div class="d-flex justify-content-between">
            <div>
              <h5 th:text="${t.title}">Title</h5>
              <p class="mb-1 text-muted" th:text="${t.description}">desc</p>
              <small class="text-secondary" th:text="${t.createdAt != null} ? ${#temporals.format(t.createdAt, 'yyyy-MM-dd HH:mm')} : 'â€”'">date</small>
            </div>
            <div class="text-end">
              <form th:action="@{'/tasks/' + ${t.id} + '/toggle'}" method="post" class="d-inline">
                <button class="btn btn-sm btn-outline-success" th:text="${t.done} ? 'Undo' : 'Done'">Done</button>
              </form>
              <form th:action="@{'/tasks/' + ${t.id} + '/delete'}" method="post" class="d-inline">
                <button class="btn btn-sm btn-outline-danger">Delete</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings -->
    <div class="tab-pane fade" id="settings" role="tabpanel">
      <h4>Settings</h4>
      <p>Application settings & helpful links</p>
      <div class="card">
        <div class="card-body">
          <p><strong>H2 Console:</strong> <a href="/h2-console" target="_blank">Open H2 Console</a></p>
          <p><strong>REST API:</strong> GET <code>/api/tasks</code>, POST <code>/api/tasks</code> etc.</p>
        </div>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
